<div class="chat-container">
  <div *ngIf="!userName" class="login-screen" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; padding: 20px;">
    <h2 style="letter-spacing: 5px; font-weight: 300; font-size: 1rem; margin-bottom: 20px; color:#3df2e0;">INITIATE PROTOCOL</h2>
    <div class="input-area" style="width: 100%; max-width: 300px;">
      <input [(ngModel)]="nameInput" placeholder="Identity..." (keyup.enter)="setUserName()" autocomplete="off">
      <button (click)="setUserName()">➔</button>
    </div>
  </div>

  <ng-container *ngIf="userName">
    <div *ngIf="connectionStatus" class="status-toast">
      <span class="pulse-dot">●</span> {{ connectionStatus }}
    </div>

    <div class="header">
      <span class="user-id-header">{{ userName }} // ACTIVE</span>
      <a href="https://nexifitech.com" target="_blank" class="dev-link">
        <span style="color: #e3e3e3; opacity: 0.6;">Developed by</span> Nexifitech
      </a>
    </div>

    <div class="messages-list" #scrollMe>
      <div *ngFor="let msg of messages; let i = index; let isLast = last" 
           [class]="msg.user === userName ? 'message-item me' : 'message-item other'">
        
        <span class="user-label">{{ msg.user }}</span>
        <div class="message-text">{{ msg.text }}</div>
        
        <div class="status-container" *ngIf="msg.user === userName && isLast">
          <span class="timestamp-text" *ngIf="msg.timestamp">{{ msg.timestamp | date:'HH:mm' }}</span>
          <span [class.status-text-synced]="seenMessages.has(msg.id)" class="status-text">
            {{ seenMessages.has(msg.id) ? '● SYNCED' : '○ UPLINKED' }}
          </span>
        </div> 
      </div>
    </div>

    <div class="typing-indicator" *ngIf="isPartnerTyping">
      <span class="dot"></span><span class="dot"></span><span class="dot"></span>
      {{ targetUser === 'public_group' ? 'Someone' : targetUser }} is typing...
    </div>

    <div class="input-wrapper">
      <div class="input-area">
        <input [(ngModel)]="newMessage" 
               placeholder="Type message..." 
               (keyup.enter)="send()" 
               (input)="onTyping()"
               autocomplete="off">
        <button (click)="send()">▲</button>
      </div>
    </div>

    <div *ngIf="sessionTerminated" class="termination-overlay">
      <div class="terminal-box">
        <h1 class="glitch-text">NEW LOGIN DETECTED</h1>
        <p>DUPLICATE SESSION INITIATED</p>
        <div class="status-line">User: {{ userName | uppercase }} // STATUS: TERMINATED</div>
        <button class="reconnect-btn" onclick="window.location.reload()">LOG BACK IN</button>
      </div>
    </div>
  </ng-container>
</div>